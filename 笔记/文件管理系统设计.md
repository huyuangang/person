# 关于文件管理的思考

描述：其实就是个课程作业啦，做了一个类似百度云的文件存储管理系统，我就负责文件管理部分。

## 界面设计
![文件系统界面](http://ojwrejtvt.bkt.clouddn.com/17-8-3/57829040.jpg)
其实真的就是上面这个图的样子啦，只是现在代码跑不起来了TnT。

所谓文件管理，大概就是做一些用户的文件增删改查，在界面的设计上都大同小异，但是在后台数据存储及操作的设计上就有很大区别了。

首先能想到的是，每个人都应该有个自己的存储空间吧，然后各放各的文件或者文件夹啥的，但是这样的设计虽然能满足一般的需求，看上去是把用户数据隔离处理了，但是这样的隔离其实并没有什么优势。

## 虚拟文件夹
![虚拟文件夹](http://ojwrejtvt.bkt.clouddn.com/17-8-3/23912572.jpg)
上图是文件夹在数据库中的存储格式（数据库为MongoDB）。
各字段解释如下表：
```js
{
	userId   //用户id，即表示属于哪个用户的文件夹
	parentId //父文件夹id，用于生成文件夹树
	name     //文件夹名
	createTime //创建时间
	updateTime //更新时间
}
```
通过这样的数据存储就不用在服务器上创建一堆又一堆的文件夹了。
## 虚拟文件
![虚拟文件](http://ojwrejtvt.bkt.clouddn.com/17-8-3/30399556.jpg)
各字段解释：
```js
{
	userId    //用户id，即表示属于哪个用户的文件夹
	name      //文件夹名
	fileId    //文件夹id，用于生成文件夹树
	dirId     //真实文件的id
	createTime //创建时间
}
```
将这些数据存储起来之后，用户不管怎么操作，都不会碰及到真实存储的文件，而只是在操作一些虚拟数据，而这些数据也仅仅用于页面展示罢了。
## 真实存储文件
![真实存储文件](http://ojwrejtvt.bkt.clouddn.com/17-8-3/19645550.jpg)
各字段解释：
```js
	hash   //文件hash值
	size   //文件大小
	path   //文件存储路径
```
## hash检测实现秒传
当我们把这些数据存储起来之后，所有用户上传的文件我们就可以放在一起，而不是像最开始说的那样隔离。每个文件都有一个独一无二的hash值，当用户上传文件时，前端需要给我提供hash值去检测，如果不存在，那么正常上传存储，如果hash值存在，那么说明这个文件在我的系统中已经有了，这时候还需要浪费流量去上传数据吗，只需要在数据库里插入一条数据就行了。

## 相关链接
[文件管理代码github地址](https://github.com/huyuangang/file-manage)
