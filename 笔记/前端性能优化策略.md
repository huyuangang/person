# 前端性能优化策略总结

描述：做前端性能优化是绕不过的一个问题，一个网站的首屏响应时间会大大影响用户的去留，虽然后台架构等优化可以改变数据返回速度，但需要花费大量的人力物力，而前端优化往往很快就能做到。

## 页面即将到达战场
> 一个网站的响应时间应该是从访问到页面可用这整个时间，而这个时间就是前端应该去优化的。那么，浏览器在这段时间都做了些什么呢？页面大致做了下面几个工作（这里只讨论服务器返回后的流程）：
1.HTML下载和解析
2.各种页面所需组件和页面下载
3.样式树和dom树渲染
4.渲染完成，用户可访问

据统计，页面响应时间只有10%~20%花在html下载上，而剩下的80%~90%的时间都花在了页面组件（比如图片、js脚本、样式表等）下载。所以我们优化的重心应该放在这80%~90%上。虽然后台一顿操作或许能加快数据返回速度，但前端只需要遵循几个规则就能提高性能，何乐而不为呢？

## 提高性能策略

> 通过学习和个人理解，我觉得性能优化策略大致可以分为四类：
1.减少http请求
2.加快请求响应速度
3.压缩传输数据量
4.缓存

### 一、减少http请求

既然大部分时间都花在了组件上，那我就少下载几个不就完了嘛，这应该是最简单最粗暴也最容易理解的优化策略了。

#### 方法：

1.合并脚本、合并样式表。
2.CSS Sprites（江湖人称雪碧图）
3.内联图片（图片base64）

### 二、加快请求响应速度

当http请求已经降到最低了，那就只能提高资源返回的速度啦。

1.使用内容分发网络（CDN）

> 内容分发网络（CDN）：其实就是当用户请求资源时，由中心服务器指定离请求最近或者能够最快响应的缓存服务器做出响应，以提高资源响应速度。

### 三、压缩传输数据量

试想，在所有条件都同等的情况下，传输500k的数据和1M的数据其传输时间
自然不言而喻了。

##### 方法；

1.精简JavaScript脚本（精简、混淆）
2.删除重复代码
3.开启压缩（gzip）

### 四、缓存

在我们请求的数据里，有很多资源其实是不会变的，如果我们不管什么时候访问同一个网站都需要重新下载所有资源的话，页面的响应速度是不会有所改善的。

##### 方法；

1.添加Cache-Control头
2.添加Expires头
3.配置ETag

> Cache-Control和Expires都是设置缓存时间的，不同的是Cache-Control的值为缓存时间长度，即从当前时间起，多长时间后缓存数据过期，而Expires则是设置时间点，表示在哪个时间缓存数据过期，若同时设置，Cache-Control的优先级大于Expires。
而ETag只是服务器给资源生成的类似于标记的东西，每次请求是去匹配ETag是否相等，若相等则表示资源未改变，无需重新下载，反之则资源改变，需重新下载。
更多内容就博友自行探索吧，或许后面会写一篇关于缓存的笔记，不过得往后推了。

## 其他

还有一些不知该分在哪类的方法就放在这里吧。

1.样式表放头部，脚本放底部。HTML页面是从上往下逐步渲染的，当遇到脚本时（不管内联还是外部），浏览器都会停下手头的工作，去执行脚本的下载和执行，这里形成阻塞，页面啥事儿也干不了，至少在脚本执行完成之前，这样带来的后果就难受了呀。
2.外部引入样式表和脚本。根据前面所说的减少http请求，那是不是内联脚本和样式会比外部脚本和样式带来的性能好呢，其实各有利弊，内联脚本和样式的好处是减少了http请求，跟随HTML文件一起下载下来，随之带来的问题是脚本和样式无法缓存，每次都得重新下载，而且如果两个页面需要同一个脚本的话就造成了重复代码；而外部脚本和样式带来的问题增加了http请求。
3.减少DNS查找
4.避免重定向
5.避免CSS表达式

## 最后
本文主要总结前端性能优化策略，而文中涉及的缓存也是前端一大问题，这里不做赘述，期待后续吧！
